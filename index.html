<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <title>Control</title>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <script src="/js/jquery-3.2.1.min.js" ></script>
    <script src="/js/bootstrap.bundle.js"></script>
</head>
<body>

<div class="container">
    <div class="row">
        <div class="col-md">
            <h2>Send vibrations </h2>
        </div>
    </div>
    <div class="row">
        <div class="col-md controlbuttons">
            <button type="button" class="btn btn-success" data-code="999999555555999999"> &xlArr; Back</button>
            <button type="button" class="btn btn-danger" data-code="1234567898765432123456789">Skip &xrArr;</button>
            <br><br>
            <button type="button" class="btn btn-success" data-code="99987654321">Answer</button>
            <button type="button" class="btn btn-success" data-code="99">1</button>
            <button type="button" class="btn btn-success" data-code="9900000099">2</button>
            <button type="button" class="btn btn-success" data-code="990000009900000099">3</button>
            <button type="button" class="btn btn-success" data-code="99000000990000009900000099">4</button>
            <button type="button" class="btn btn-success" data-code="9900000099000000990000009900000099">5</button>
            <button type="button" class="btn btn-success" data-code="990000009900000099000000990000009900000099">6</button>
            <button type="button" class="btn btn-success" data-code="99000000990000009900000099000000990000009900000099">7</button>
            <button type="button" class="btn btn-success" data-code="9900000099000000990000009900000099000000990000009900000099">8</button>
            <button type="button" class="btn btn-success" data-code="990000009900000099000000990000009900000099000000990000009900000099">9</button>
            <button type="button" class="btn btn-success" data-code="99000000990000009900000099000000990000009900000099000000990000009900000099">10</button>
            <button type="button" class="btn btn-warning" data-code="123456000123456">OR</button>
            <br><br>
            <button type="button" class="btn btn-info" data-code="12345678999999987654321">Trappe op og ned</button>
            <button type="button" class="btn btn-info" data-code="987654321111111123456789">Trappe ned og op</button>


            <br><br><br><br><br>
            <h2>Training</h2>
            <button type="button" class="btn btn-success" data-code="99987654321">Answer</button>
            <button type="button" class="btn btn-warning" data-code="123456000123456">OR</button>
            <button type="button" class="btn btn-success" data-code="999999555555999999"> &xlArr; Back</button>
            <button type="button" class="btn btn-danger" data-code="1234567898765432123456789">Skip &xrArr;</button>
            <br><br>
            <button type="button" class="btn btn-success" data-code="99">1</button>
            <button type="button" class="btn btn-success" data-code="9900000099">2</button>
            <button type="button" class="btn btn-success" data-code="990000009900000099">3</button>
            <button type="button" class="btn btn-success" data-code="99000000990000009900000099">4</button>
            <button type="button" class="btn btn-success" data-code="9900000099000000990000009900000099">5</button>
            <button type="button" class="btn btn-success" data-code="990000009900000099000000990000009900000099">6</button>
            <button type="button" class="btn btn-success" data-code="99000000990000009900000099000000990000009900000099">7</button>
            <button type="button" class="btn btn-success" data-code="9900000099000000990000009900000099000000990000009900000099">8</button>
            <button type="button" class="btn btn-success" data-code="990000009900000099000000990000009900000099000000990000009900000099">9</button>
            <button type="button" class="btn btn-success" data-code="99000000990000009900000099000000990000009900000099000000990000009900000099">10</button>
        </div>
        <div class="col-md-2">
            <span id="bullet" style="font-size:500px; line-height: 0.0;">&bull;</span>
            <h4>History</h4>
            <div id="log">
            </div>
        </div>
    </div>
</div>


<script>
    $(document).ready( function () {
        var delay = 50;

        $(".controlbuttons .btn").each(function () {

            $(this).click(function () {
                var name = $(this).text();
                var code = String($(this).data('code'));
                console.log("Sender", name, ":", code);
                $("#log").prepend($('<div>').html(name));
                sendVibration(code);
            })
        });

        function sendVibration(code) {
            var data = {
                code: code,
                delay: delay
            };

            //$(".btn").prop('disabled', true);

            $.get( "http://192.168.4.1/vibrate", data, function( data ) {
                //$( ".result" ).html( data );
            }).always(function () {

            });
            visualFeedback(code);
        }

        function visualFeedback(code) {
            var instruction = code.slice(0, 1);
            var restOfCode = code.substring(1);
            var color = null;

            if (instruction === '0') {
                color = 'rgb(200,200,200)';
            } else if (instruction == "") {
                color = 'rgb(200,200,200)';
            } else {
                var bab = 100+(instruction*15);
                //console.log(bab);
                color = 'rgb('+bab+',0,0)'
            }

            $("#bullet").css('color', color);

            console.log('instruction', instruction, "restOfCode", restOfCode);
            if (instruction !== "") {
                setTimeout(visualFeedback, delay, restOfCode);
            } else {
                //$(".btn").prop('disabled', false);
            }
        }
    });
    

</script>

</body>
</html>
